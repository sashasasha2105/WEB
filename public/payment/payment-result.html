<!-- File: public/payment/payment-result.html -->

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Результат оплаты — clip & go</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Montserrat -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
            href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap"
            rel="stylesheet"
    />

    <!-- Локальные стили -->
    <link rel="stylesheet" href="payment-result.css" />
</head>
<body>
<div class="container">
    <!-- Хедер с благодарностью -->
    <div class="header">
        <h1>Спасибо за покупку!</h1>
        <p>Ваш платёж успешно обработан и подтверждён.</p>
        <p class="processing-note">Заказ в системе доставки создается автоматически. Вы можете отслеживать его статус в личном кабинете.</p>
    </div>

    <!-- Детали заказа -->
    <div class="order-details">
        <h2>Ваш заказ:</h2>
        <ul class="items-list" id="itemsList">
            <!-- JS подставит li с товарами -->
        </ul>

        <div class="total-block">
            <h2>Итого: <span id="totalAmount">0 ₽</span></h2>
        </div>
    </div>

    <!-- Кнопки навигации -->
    <div class="buttons">
        <a href="/index.html" class="btn-home">На главную</a>
        <a href="/profile/profile.html" class="btn-orders">Мой профиль</a>
    </div>

    <!-- Способы оплаты -->
    <div class="payment-methods">
        <h3>Мы принимаем:</h3>
        <ul class="methods-list">
            <li><img src="/assets/icons/payments/visa.png" alt="Visa" /></li>
            <li><img src="/assets/icons/payments/mastercard.png" alt="Mastercard" /></li>
            <li><img src="/assets/icons/payments/mir.png" alt="Мир" /></li>
            <li><img src="/assets/icons/payments/sbp.png" alt="СБП" /></li>
        </ul>
    </div>
</div>

<script>
    // При загрузке страницы читаем данные из localStorage (cartData),
    // чтобы вывести купленные товары, их количество и цены.
    document.addEventListener('DOMContentLoaded', () => {
        const itemsListEl = document.getElementById('itemsList');
        const totalAmountEl = document.getElementById('totalAmount');

        // Достаём данные корзины: { cameraCount: X, memoryCount: Y }
        const cartData = JSON.parse(localStorage.getItem('cartData') || '{}');
        const cameraCount = cartData.cameraCount || 0;
        const memoryCount = cartData.memoryCount || 0;

        // Цены (должны совпадать с тем, что в cart.js)
        const CAMERA_PRICE = 8900;
        const MEMORY_PRICE = 500;

        let total = 0;

        // Если купили хотя бы одну камеру:
        if (cameraCount > 0) {
            const li = document.createElement('li');
            li.innerHTML = `
          <img class="item-image" src="/assets/images/cam3.jpg" alt="clip & go" />
          <div class="item-info">
            <h3>clip & go</h3>
            <p>Количество: ${cameraCount} шт.</p>
            <p>Цена за шт.: ${CAMERA_PRICE.toLocaleString('ru-RU')} ₽</p>
          </div>
          <div class="item-price">${(CAMERA_PRICE * cameraCount).toLocaleString('ru-RU')} ₽</div>
        `;
            itemsListEl.appendChild(li);
            total += CAMERA_PRICE * cameraCount;
        }

        // Если купили карты памяти:
        if (memoryCount > 0) {
            const li = document.createElement('li');
            li.innerHTML = `
          <img class="item-image" src="/assets/images/CardPhoto.png" alt="Карта памяти 8 ГБ" />
          <div class="item-info">
            <h3>Карта памяти 8 ГБ</h3>
            <p>Количество: ${memoryCount} шт.</p>
            <p>Цена за шт.: ${MEMORY_PRICE.toLocaleString('ru-RU')} ₽</p>
          </div>
          <div class="item-price">${(MEMORY_PRICE * memoryCount).toLocaleString('ru-RU')} ₽</div>
        `;
            itemsListEl.appendChild(li);
            total += MEMORY_PRICE * memoryCount;
        }

        // Если корзина пуста (на всякий случай)
        if (cameraCount === 0 && memoryCount === 0) {
            const li = document.createElement('li');
            li.style.textAlign = 'center';
            li.style.fontSize = '1.1em';
            li.style.color = '#777';
            li.textContent = 'Корзина пуста';
            itemsListEl.appendChild(li);
        }

        // Устанавливаем итоговую сумму
        totalAmountEl.textContent = total.toLocaleString('ru-RU') + ' ₽';

        // Показываем уведомление о автоматическом создании заказа
        setTimeout(() => {
            showNotification('Заказ автоматически создается в системе доставки СДЭК. Вы получите уведомление на email когда заказ будет готов к отправке.', 'info');
        }, 2000);

        // НЕ очищаем корзину сразу - дадим пользователю время ознакомиться
        // Очистим через 30 секунд или когда пользователь уйдет со страницы
        setTimeout(() => {
            localStorage.removeItem('cartData');
        }, 30000);

        // Очистка при уходе со страницы
        window.addEventListener('beforeunload', () => {
            localStorage.removeItem('cartData');
        });
    });

    // Функция показа уведомлений
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            max-width: 350px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideInNotification 0.5s ease;
        `;

        switch (type) {
            case 'info':
                notification.style.backgroundColor = '#007BFF';
                break;
            case 'success':
                notification.style.backgroundColor = '#28a745';
                break;
            case 'error':
                notification.style.backgroundColor = '#dc3545';
                break;
        }

        notification.textContent = message;

        // Добавляем CSS анимации
        if (!document.querySelector('#notification-styles')) {
            const style = document.createElement('style');
            style.id = 'notification-styles';
            style.textContent = `
                @keyframes slideInNotification {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOutNotification {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        document.body.appendChild(notification);

        // Автоматически удаляем через 8 секунд
        setTimeout(() => {
            notification.style.animation = 'slideOutNotification 0.5s ease';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 500);
        }, 8000);

        // Клик для закрытия
        notification.addEventListener('click', () => {
            notification.style.animation = 'slideOutNotification 0.5s ease';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 500);
        });

        notification.style.cursor = 'pointer';
        notification.title = 'Нажмите, чтобы закрыть';
    }
</script>

</body>
</html>